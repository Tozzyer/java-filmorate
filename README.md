# Java filmorate

*Как работает база данных:*

**1. Таблица movie**  
PK: movie_id (уникальный идентификатор фильма)  
Содержит основные поля с названием, описанием фильма, id жанра (one to one с таблицей genre), mpa_id(one to one с таблицей mpa)  
**2. Таблица movie_advanced**  
PK: movie_id (one to one с таблицей movie)  
Содержит дополнительную информацию о фильме. Создана для опциональных характеристик картины с запасом на расширение, что бы не перегружать остальное.  
**3. Таблицы genre, mpa** - содержат информацию о жанре и рейтинге фильма. Вынесены в отдельную таблицу для упрощения корректировок значений.  
**4. Таблица user**  
PK: user_id (уникальный идентификатор пользователя)  
Содержит основные поля, характеризующие пользователя  
**5. Таблица user_friendlist**  
PK: user_id+friend_id - ключ составной, связка id юзера+ id юзера-друга уникальна.  
Предполагается выгрузка списка друзей по user_id и фильтрация по friendship_status, который отражает статус взаимоотношений:  
0 - запрос отправлен от "друга"  
1 - запрос согласован.  
**6. Таблица movie_rating**   
PK: movie_id + user_id - ключ составной, связка фильма и id лайкнувшего юзера уникальна.   
Из неё можно будет каунтить рейтинг фильма по id, а также искать пересечения по лайкнувшим юзерам для составления списка обших фильмов.

**Примеры запросов**
1. Получение фильма по id:
    SELECT*
    FROM movie
    WHERE movie_id = {id фильма};
2. Получение TOP-10 фильмов
    SELECT *
    FROM movie
    WHERE movie_id IN (SELECT movie_id
    FROM movie_rating
    GROUP BY movie_id
    ORDER BY COUNT(user_id) DESC
    LIMIT 10);

    

![Диаграмма базы данных](src/main/resources/Java-filmorate%20SQL%20db.png)

SP12 start